<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link rel="icon" type="image/png" href="logo2.png" />
    <title>OSINT // EXIF EXTRACTOR</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exifreader@4.12.0/dist/exif-reader.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#13ec63", "primary-dim": "#0eac48", "background-light": "#f6f8f7", "background-dark": "#050a07", "surface-dark": "#0f1612", "surface-border": "#1f2e25", },
                    fontFamily: { "display": ["Space Grotesk", "sans-serif"], "mono": ["JetBrains Mono", "monospace"], },
                    backgroundImage: { 'cyber-grid': "linear-gradient(to right, #1f2e25 1px, transparent 1px), linear-gradient(to bottom, #1f2e25 1px, transparent 1px)", }
                },
            },
        }
    </script>
    <style>
        .neon-glow {
            box-shadow: 0 0 10px rgba(19, 236, 99, 0.2);
        }

        .grid-bg {
            background-size: 40px 40px;
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f1612;
        }

        ::-webkit-scrollbar-thumb {
            background: #1f2e25;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #13ec63;
        }

        #map {
            height: 100%;
            width: 100%;
            background: #050a07;
            filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
        }

        .drop-zone {
            border: 2px dashed #1f2e25;
            transition: all 0.3s ease;
        }

        .drop-zone.dragover {
            border-color: #13ec63;
            background: rgba(19, 236, 99, 0.05);
        }

        /* Map Popup Styling */
        .leaflet-popup-content-wrapper {
            background: #0f1612;
            color: #fff;
            border: 1px solid #13ec63;
        }

        .leaflet-popup-tip {
            background: #13ec63;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 min-h-screen flex flex-col overflow-x-hidden selection:bg-primary selection:text-black">
    <div class="fixed inset-0 pointer-events-none opacity-20 bg-cyber-grid grid-bg z-0"></div>

    <div class="relative z-10 flex flex-col h-full grow">
        <header
            class="sticky top-0 z-50 flex items-center justify-between border-b border-surface-border bg-surface-dark/95 backdrop-blur-md px-6 py-3">
            <div class="flex items-center gap-4 text-white">
                <div
                    class="size-8 text-primary flex items-center justify-center rounded bg-primary/10 border border-primary/20 neon-glow">
                    <img src="logo2.png" alt="Logo" class="w-6 h-6 object-contain" />
                </div>
                <div class="flex flex-col">
                    <h2 class="text-white text-xl font-bold tracking-tight uppercase">OSINT <span
                            class="text-primary">//</span> EXIF EXTRACTOR</h2>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div
                    class="flex items-center gap-2 px-3 py-1 bg-primary/10 border border-primary/20 rounded text-primary text-xs font-mono font-bold">
                    <span class="material-symbols-outlined text-[14px]">all_inclusive</span>
                    CREDITS: UNLIMITED
                </div>

                <a href="dashboard.html"
                    class="flex items-center gap-2 px-4 py-1.5 bg-surface-dark border border-surface-border hover:border-primary text-slate-300 hover:text-primary rounded transition-all text-xs font-bold font-mono group">
                    <span
                        class="material-symbols-outlined text-[16px] group-hover:-translate-x-1 transition-transform">arrow_back</span>
                    DASHBOARD
                </a>

                <div class="size-9 rounded-full bg-gradient-to-br from-primary to-blue-500 p-[1px]">
                    <div
                        class="size-full rounded-full bg-surface-dark flex items-center justify-center overflow-hidden">
                        <span class="material-symbols-outlined text-white text-[20px]">person</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 px-4 md:px-8 py-6 w-full max-w-[1600px] mx-auto flex flex-col gap-6">

            <div class="drop-zone rounded-lg p-10 text-center bg-surface-dark/50 cursor-pointer group" id="drop-zone">
                <input type="file" id="fileInput" class="hidden"
                    accept="image/jpeg, image/png, image/tiff, image/webp, image/heic">
                <div class="flex flex-col items-center gap-3 group-hover:scale-105 transition-transform duration-300">
                    <div class="p-4 bg-primary/10 rounded-full text-primary mb-2 shadow-[0_0_15px_rgba(19,236,99,0.2)]">
                        <span class="material-symbols-outlined text-4xl">cloud_upload</span>
                    </div>
                    <h3 class="text-xl font-bold text-white">Drop Evidence Here</h3>
                    <p class="text-slate-400 text-sm font-mono">Supports RAW, JPG, PNG, HEIC (Deep Scan)</p>
                </div>
            </div>

            <div id="resultsContainer"
                class="hidden grid grid-cols-1 lg:grid-cols-3 gap-6 animate-in fade-in slide-in-from-bottom-4 duration-500">

                <div class="flex flex-col gap-6 lg:col-span-1">
                    <div class="bg-surface-dark border border-surface-border rounded-lg overflow-hidden relative group">
                        <div
                            class="absolute top-2 left-2 bg-black/80 px-2 py-1 rounded text-xs font-mono text-primary z-10 border border-primary/20">
                            TARGET PREVIEW</div>
                        <img id="imgPreview" class="w-full h-auto object-contain max-h-[400px] bg-black/50" src="">

                        <div id="fallbackTool"
                            class="hidden absolute bottom-0 left-0 right-0 bg-black/90 p-4 border-t border-red-500/30">
                            <p class="text-red-400 text-xs font-bold mb-2 flex items-center gap-2">
                                <span class="material-symbols-outlined text-[16px]">warning</span>
                                METADATA SCRUBBED
                            </p>
                            <button onclick="googleReverseSearch()"
                                class="w-full bg-white/10 hover:bg-white/20 text-white text-xs py-2 rounded font-mono border border-white/20 flex items-center justify-center gap-2 transition-all">
                                <span class="material-symbols-outlined text-[14px]">image_search</span>
                                TRY DEEP REVERSE SEARCH
                            </button>
                        </div>
                    </div>

                    <div id="mapContainer"
                        class="bg-surface-dark border border-surface-border rounded-lg overflow-hidden h-[300px] relative hidden shadow-lg shadow-black/50">
                        <div id="map"></div>
                        <div
                            class="absolute bottom-2 right-2 bg-black/90 px-3 py-1 rounded text-xs font-mono text-primary z-[1000] border border-primary/30 flex items-center gap-2">
                            <span class="size-2 bg-primary rounded-full animate-pulse"></span>
                            GPS LOCKED
                        </div>
                    </div>

                    <div class="bg-surface-dark border border-surface-border p-5 rounded-lg">
                        <h3 class="text-xs font-mono text-slate-400 uppercase mb-2">Intelligence Score</h3>
                        <div class="flex items-end gap-3">
                            <span id="riskScore" class="text-4xl font-bold text-white font-mono">0%</span>
                            <span id="riskLabel" class="text-sm font-mono text-slate-500 mb-1">NO DATA</span>
                        </div>
                        <div class="w-full bg-slate-800 h-1 mt-3 rounded-full overflow-hidden">
                            <div id="riskBar" class="h-full bg-primary w-0 transition-all duration-1000"></div>
                        </div>
                    </div>
                </div>

                <div
                    class="lg:col-span-2 bg-surface-dark border border-surface-border rounded-lg flex flex-col overflow-hidden min-h-[600px] shadow-lg">
                    <div class="px-6 py-4 border-b border-surface-border flex justify-between items-center bg-black/20">
                        <h3 class="font-bold text-white tracking-wide text-sm font-display flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary text-[18px]">terminal</span>
                            EXTRACTED DATA
                        </h3>
                        <div class="flex gap-2">
                            <span id="tagCount" class="text-xs font-mono text-slate-500 pt-1">WAITING...</span>
                            <button onclick="exportJSON()"
                                class="text-xs font-mono text-primary hover:text-white flex items-center gap-1 ml-4 transition-colors">
                                <span class="material-symbols-outlined text-[14px]">download</span> REPORT
                            </button>
                        </div>
                    </div>

                    <div class="flex-1 overflow-auto p-0 scrollbar-hide">
                        <table class="w-full text-left text-sm font-mono">
                            <thead
                                class="bg-surface-border/30 text-slate-400 text-xs uppercase sticky top-0 backdrop-blur-md z-10">
                                <tr>
                                    <th class="px-6 py-3 w-1/3">Tag Name</th>
                                    <th class="px-6 py-3">Value</th>
                                </tr>
                            </thead>
                            <tbody id="metaTableBody" class="divide-y divide-surface-border text-slate-300">
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('fileInput');
        const resultsContainer = document.getElementById('resultsContainer');
        let currentExifData = {};
        let mapInstance = null;
        let currentImgUrl = null;

        // --- DRAG & DROP HANDLERS ---
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) handleFile(e.target.files[0]);
        });

        async function handleFile(file) {
            if (!file) return;

            // Reset UI
            resultsContainer.classList.remove('hidden');
            document.getElementById('mapContainer').classList.add('hidden');
            document.getElementById('fallbackTool').classList.add('hidden');
            document.getElementById('metaTableBody').innerHTML = `<tr><td colspan="2" class="px-6 py-8 text-center text-primary animate-pulse">Deep Scanning Binary Data...</td></tr>`;

            // Image Preview
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('imgPreview').src = e.target.result;
                currentImgUrl = e.target.result; // Store for reverse search
            };
            reader.readAsDataURL(file);

            try {
                // THE FIX: Use ExifReader.load on the FILE object, not the image element
                const tags = await ExifReader.load(file);
                currentExifData = tags;
                processExif(tags);
            } catch (error) {
                console.error(error);
                showNoDataState("Corrupted or unsupported file format.");
            }
        }

        function processExif(tags) {
            const tbody = document.getElementById('metaTableBody');
            tbody.innerHTML = ''; // Clear loading state

            const keys = Object.keys(tags).filter(k => k !== 'MakerNote' && k !== 'UserComment'); // Filter noise

            document.getElementById('tagCount').innerText = `${keys.length} TAGS FOUND`;

            // Check if empty (Scrubbed)
            if (keys.length === 0 || (keys.length < 5 && !tags.GPSLatitude)) {
                showNoDataState("Metadata scrubbed by social media or editing software.");
                return;
            }

            // 1. Calculate Risk & Populate Table
            let risk = 0;

            keys.forEach(key => {
                const val = tags[key].description || tags[key].value;
                // Risk Logic
                if (key === 'GPSLatitude') risk += 50;
                if (key === 'Model' || key === 'Make') risk += 15;
                if (key === 'Software') risk += 10;
                if (key === 'DateTimeOriginal') risk += 10;

                const row = `
                <tr class="hover:bg-primary/5 transition-colors group">
                    <td class="px-6 py-2 font-bold text-primary group-hover:text-white transition-colors border-r border-surface-border/50 text-xs">${key}</td>
                    <td class="px-6 py-2 text-slate-300 break-all text-xs font-mono">${String(val).substring(0, 100)}</td>
                </tr>
            `;
                tbody.innerHTML += row;
            });

            updateRiskUI(risk);

            // 2. Handle Map
            if (tags.GPSLatitude && tags.GPSLongitude) {
                // ExifReader gives convenient decimal conversion
                const lat = tags.GPSLatitude.description;
                const lon = tags.GPSLongitude.description;

                // Sometimes it returns arrays, handle strictly
                if (lat && lon) {
                    initMap(parseFloat(lat), parseFloat(lon));
                }
            }
        }

        function showNoDataState(reason) {
            const tbody = document.getElementById('metaTableBody');
            tbody.innerHTML = `
            <tr><td colspan="2" class="px-6 py-12 text-center">
                <span class="material-symbols-outlined text-4xl text-slate-600 mb-2">do_not_disturb_on</span><br>
                <span class="text-slate-500 font-bold">NO USABLE METADATA</span><br>
                <span class="text-slate-600 text-xs">${reason}</span>
            </td></tr>
        `;
            document.getElementById('fallbackTool').classList.remove('hidden');
            updateRiskUI(0);
        }

        function updateRiskUI(score) {
            const bar = document.getElementById('riskBar');
            const num = document.getElementById('riskScore');
            const label = document.getElementById('riskLabel');

            // Cap at 100
            score = score > 100 ? 100 : score;

            num.innerText = `${score}%`;
            bar.style.width = `${score}%`;

            if (score > 70) {
                bar.className = "h-full bg-red-500 w-0 transition-all duration-1000";
                num.className = "text-4xl font-bold text-red-500 font-mono";
                label.innerText = "CRITICAL";
                label.className = "text-sm font-mono text-red-500 mb-1";
            } else if (score > 30) {
                bar.className = "h-full bg-yellow-500 w-0 transition-all duration-1000";
                num.className = "text-4xl font-bold text-yellow-500 font-mono";
                label.innerText = "MODERATE";
                label.className = "text-sm font-mono text-yellow-500 mb-1";
            } else {
                bar.className = "h-full bg-primary w-0 transition-all duration-1000";
                num.className = "text-4xl font-bold text-primary font-mono";
                label.innerText = "LOW";
                label.className = "text-sm font-mono text-primary mb-1";
            }
        }

        function initMap(lat, lon) {
            const container = document.getElementById('mapContainer');
            container.classList.remove('hidden');

            if (mapInstance) mapInstance.remove();

            mapInstance = L.map('map').setView([lat, lon], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; CARTO',
                maxZoom: 19
            }).addTo(mapInstance);

            const customIcon = L.divIcon({
                className: 'custom-div-icon',
                html: "<div style='background-color:#13ec63; width:12px; height:12px; border-radius:50%; box-shadow:0 0 15px #13ec63; border:2px solid white;'></div>",
                iconSize: [12, 12],
                iconAnchor: [6, 6]
            });

            L.marker([lat, lon], { icon: customIcon }).addTo(mapInstance)
                .bindPopup(`<b style="color:black">TARGET LOCATED</b><br><span style="color:black">${lat.toFixed(5)}, ${lon.toFixed(5)}</span>`)
                .openPopup();
        }

        function googleReverseSearch() {
            window.open('https://images.google.com/', '_blank');
        }

        function exportJSON() {
            if (!currentExifData) return;
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(currentExifData, null, 2));
            const a = document.createElement('a');
            a.href = dataStr;
            a.download = "osint_exif_report.json";
            a.click();
        }
    </script>
</body>

</html>